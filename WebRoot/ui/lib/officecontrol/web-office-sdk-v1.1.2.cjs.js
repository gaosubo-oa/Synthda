"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function __rest(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&(n[r[a]]=e[r[a]])}return n}function __decorate(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i}function __param(e,t){return function(n,r){t(n,r,e)}}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,n,r){return new(n||(n=Promise))(function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,s)}c((r=r.apply(e,t||[])).next())})}function __generator(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function __exportStar(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function __values(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||s(e,t)})})}function s(e,t){try{(n=a[e](t)).value instanceof __await?Promise.resolve(n.value.v).then(c,u):l(o[0][2],n)}catch(e){l(o[0][3],e)}var n}function c(e){s("next",e)}function u(e){s("throw",e)}function l(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function __asyncDelegator(e){var t,n;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(n=!n)?{value:__await(e[r](t)),done:"return"===r}:a?a(t):t}:a}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,a){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,a,(t=e[n](t)).done,t.value)})}}}function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function __importStar(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function __importDefault(e){return e&&e.__esModule?e:{default:e}}var tslib_1=Object.freeze({__extends:__extends,get __assign(){return __assign},__rest:__rest,__decorate:__decorate,__param:__param,__metadata:__metadata,__awaiter:__awaiter,__generator:__generator,__exportStar:__exportStar,__values:__values,__read:__read,__spread:__spread,__await:__await,__asyncGenerator:__asyncGenerator,__asyncDelegator:__asyncDelegator,__asyncValues:__asyncValues,__makeTemplateObject:__makeTemplateObject,__importStar:__importStar,__importDefault:__importDefault}),Message=function(){function e(){}return e.add=function(t){e._handleList.push(t),window.addEventListener("message",t,!1)},e.remove=function(t){var n=e._handleList.indexOf(t);n>=0&&e._handleList.splice(n,1),window.removeEventListener("message",t,!1)},e.empty=function(){for(;e._handleList.length;)window.removeEventListener("message",e._handleList.shift(),!1)},e.parse=function(e){return"object"==typeof e?e:e?JSON.parse(e):e},e._handleList=[],e}();function isPlainObject(e){if(!e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function addStylesheetRules(e){var t=document.createElement("style");document.head.appendChild(t);var n=t.sheet;n.insertRule(e,n.cssRules.length)}var officeTypes,officeNameTypes,modeTypes,_this=this;!function(e){e.unknown="unknown",e.spreadsheet="s",e.writer="w",e.presentation="p",e.pdf="f"}(officeTypes||(officeTypes={})),function(e){e.wps="w",e.et="s",e.presentation="p",e.pdf="f"}(officeNameTypes||(officeNameTypes={})),function(e){e.nomal="nomal",e.simple="simple"}(modeTypes||(modeTypes={}));var iframe,getId=function(e){return function(){return++e}}(0),getIframe=function(e,t,n){if(void 0===n&&(n=!0),!iframe){var r=handleMountResize.bind(null,t);(iframe=document.createElement("iframe")).classList.add("web-office-iframe");var a={id:"office-iframe",src:e,scrolling:"no",frameborder:"0",allowfullscreen:"allowfullscreen",webkitallowfullscreen:"true",mozallowfullscreen:"true"};for(var o in t?(a.style="width: "+t.clientWidth+"px; height: "+t.clientHeight+"px;",n&&window.addEventListener("resize",r)):((t=document.createElement("div")).classList.add("web-office-default-container"),addStylesheetRules(".web-office-default-container {position: absolute; padding: 0;  margin: 0; width: 100vw; height: 100vh; left: 0; top: 0;}"),document.body.appendChild(t),a.style="width: 100vw; height: 100vh;"),a)iframe.setAttribute(o,a[o]);t.appendChild(iframe),iframe.destroy=function(){iframe.parentNode.removeChild(iframe),iframe=null,window.removeEventListener("resize",r)}}return iframe};function handleMountResize(e){iframe.style.cssText+="height: "+e.clientHeight+"px; width: "+e.clientWidth+"px"}var sendMsgToWps=function(e){getIframe().contentWindow.postMessage(JSON.stringify(e),"*")};function apiSender(e,t,n){return new Promise(function(r){var a=getId(),o=function(e){var t=Message.parse(e.data);t.eventName===n&&t.msgId===a&&(r(t.data),Message.remove(o))};Message.add(o),sendMsgToWps({eventName:t,data:e,msgId:a})})}var apiChannelOld=function(e){return apiSender(e,"wps.jssdk.api","wps.api.reply")},apiBasicChannel=function(e){return apiSender(e,"api.basic","api.basic.reply")},apiChannel=function(e,t,n,r){return __awaiter(_this,void 0,void 0,function(){var a,o,i,s,c,u,l,f;return __generator(this,function(p){switch(p.label){case 0:return a=getId(),s=new Promise(function(e,t){o=e,i=t}),c={},t.args?[4,reduceArgs(t.args)]:[3,2];case 1:u=p.sent(),l=u[0],f=u[1],t.args=l,c=f,p.label=2;case 2:return handleSendApiChannel([{eventName:e,data:t,msgId:a},function(){var t=this,u=function(s){return __awaiter(t,void 0,void 0,function(){var t,l,f;return __generator(this,function(p){switch(p.label){case 0:return"api.callback"===(t=Message.parse(s.data)).eventName&&t.callbackId&&c[t.callbackId]?[4,c[t.callbackId].apply(c,t.data.args)]:[3,2];case 1:l=p.sent(),sendMsgToWps({eventName:"api.callback.reply",result:l,callbackId:t.callbackId}),p.label=2;case 2:return t.eventName===e+".reply"&&t.msgId===a&&(t.error?((f=new Error("")).stack=t.error+"\n"+n,r&&r(),i(f)):o(t.result),Message.remove(u)),[2]}})})};return Message.add(u),s}]),[2,s]}})})};function reduceArgs(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,o,i,s;return __generator(this,function(c){switch(c.label){case 0:t={},n=[],e=e.slice(0),c.label=1;case 1:return e.length?(r=void 0,[4,e.shift()]):[3,3];case 2:if(a=c.sent(),isPlainObject(r))for(o in r={},a)"function"==typeof(i=a[o])&&(s=getId(),t[s]=i,i={callbackId:s}),r[o]=i;else"function"==typeof a?(s=getId(),t[s]=a,r={callbackId:s}):r=a;return n.push(r),[3,1];case 3:return[2,[n,t]]}})})}function handleSendApiChannel(e){var t=e[0],n=e[1];"function"==typeof(t=__assign({},t)).data&&(t.data=t.data()),n(),sendMsgToWps(t)}var userConfHandler=function(e,t){void 0===t&&(t=!0);var n=__assign({},e),r=n.headers,a=void 0===r?{}:r,o=n.subscriptions,i=void 0===o?{}:o,s=n.mode,c=void 0===s?modeTypes.nomal:s,u=a.backBtn,l=void 0===u?{}:u,f=a.shareBtn,p=void 0===f?{}:f,d=a.otherMenuBtn,_=void 0===d?{}:d,v=function(e,n){e.subscribe&&"function"==typeof e.subscribe&&(e.callback=n,i[n]=e.subscribe,t&&delete e.subscribe)};if(v(l,"wpsconfig_back_btn"),v(p,"wpsconfig_share_btn"),v(_,"wpsconfig_other_menu_btn"),_.items&&Array.isArray(_.items)){var m=[];_.items.forEach(function(e,t){switch(void 0===e&&(e={}),e.type){case"export_img":e.type=1,e.callback="export_img";break;case"export_pdf":e.type=1,e.callback="export_pdf";break;case"save_version":e.type=1,e.callback="save_version";break;case"about_wps":e.type=1,e.callback="about_wps";break;case"split_line":e.type=2;break;case"custom":e.type=3,v(e,"wpsconfig_other_menu_btn_"+t),m.push(e)}}),m.length&&(isMobile||isInMiniProgram)&&(_.items=m)}if(n.url=n.url||n.wpsUrl,(c===modeTypes.simple||n.commonOptions&&!1===n.commonOptions.isShowTopArea)&&n.url&&(n.url+="&simple&hidecmb"),n.debug&&n.url&&(n.url+="&debugger"),n.wordOptions&&(n.wpsOptions=n.wordOptions),n.excelOptions&&(n.etOptions=n.excelOptions),n.pptOptions&&(n.wppOptions=n.pptOptions),"object"==typeof i.print){var b="wpsconfig_print";"function"==typeof i.print.subscribe&&(i[b]=i.print.subscribe,n.print={callback:b},void 0!==i.print.custom&&(n.print.custom=i.print.custom)),delete i.print}"function"==typeof i.exportPdf&&(i[b="wpsconfig_export_pdf"]=i.exportPdf,n.exportPdf={callback:b},delete i.exportPdf);return n.commandBars&&setCommandBars(n.commandBars,!1),__assign({},n,{subscriptions:i})},getOfficeType=function(e){void 0===e&&(e="");var t="";if(!t&&e){var n=e.toLowerCase();-1!==n.indexOf("/office/s/")&&(t=officeTypes.spreadsheet),-1!==n.indexOf("/office/w/")&&(t=officeTypes.writer),-1!==n.indexOf("/office/p/")&&(t=officeTypes.presentation),-1!==n.indexOf("/office/f/")&&(t=officeTypes.pdf)}if(!t){var r=e.match(/[\?&]type=([a-z]+)/)||[];t=officeNameTypes[r[1]]||""}return t};function setCommandBars(e,t){void 0===t&&(t=!0);var n=e.map(function(e){var t=e.attributes;if(!Array.isArray(t)){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var a={name:r,value:t[r]};n.push(a)}e.attributes=n}return e});return t&&sendMsgToWps({eventName:"setCommandBars",data:n}),n}var agent=window.navigator.userAgent.toLowerCase(),isMobile=/Android|webOS|iPhone|iPod|BlackBerry|iPad/i.test(agent),isInMiniProgram=function(){try{return-1!==window._parent.location.search.indexOf("from=wxminiprogram")}catch(e){return!1}}();function mitt(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}}var objId=0,collectObjIdHandlers=new Set;function createObjId(e){return++objId,!e&&collectObjId(objId),objId}function collectObjId(e){collectObjIdHandlers.forEach(function(t){return t(e)})}function makeCollectObjIdHandle(e){return function(){var t=[],n=function(e){t.push(e)};return collectObjIdHandlers.add(n),{End:function(){e(t),collectObjIdHandlers.delete(n)}}}}function destroyApplication(){collectObjIdHandlers=new Set,objId=0}function initApplication(e,t){var n=this,r=t.Events,a=t.Enum,o=t.Props,i=o[0],s=o[1],c={objId:objId};switch(assign(c,i,s),c.Events=r,c.Enum=a,e.Enum=c.Enum,e.Events=c.Events,getOfficeType(e.url)){case officeTypes.writer:e.WordApplication=e.WpsApplication=function(){return c};break;case officeTypes.spreadsheet:e.ExcelApplication=e.EtApplication=function(){return c};break;case officeTypes.presentation:e.PPTApplication=e.WppApplication=function(){return c};break;case officeTypes.pdf:e.PDFApplication=function(){return c}}e.Application=c,e.Free=function(e){return apiChannel("api.free",{objId:e},"")},e.Stack=c.Stack=makeCollectObjIdHandle(function(t){return e.Free(t)});var u={};Message.add(function(e){return __awaiter(n,void 0,void 0,function(){var t,n,r,a,o;return __generator(this,function(i){switch(i.label){case 0:return"api.event"===(t=Message.parse(e.data)).eventName&&t.data?(n=t.data,r=n.eventName,a=n.data,n.objIds,(o=u[r])?[4,o(a)]:[3,2]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})}),c.Sub={},Object.values(r).forEach(function(e){Object.defineProperty(c.Sub,e,{set:function(t){u[e]=t,sendMsgToWps({eventName:"api.event.register",data:{eventName:e,register:!!t,objId:++objId}})}})})}var wps,polyfillApi=["ExportAsFixedFormat","GetOperatorsInfo","ImportDataIntoFields","ReplaceText","ReplaceBookmark","GetBookmarkText","GetComments"];function assign(e,t,n){t=t.slice(0);for(var r=function(){var r=t.shift();!r.alias&&~polyfillApi.indexOf(r.prop)&&t.push(__assign({},r,{alias:r.prop+"Async"})),Object.defineProperty(e,r.alias||r.prop,{get:function(){var t=this,a=1===r.cache,o=a&&this["__"+r.prop+"CacheValue"];if(o)return o;var i=new Error("").stack.split("\n").slice(2).join("\n"),s=createObjId(a),c=function(){for(var t,a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];return void 0!==r.caller?assign(t={objId:createObjId()},n[r.caller],n):t={},wrapper(c,t,"api.caller",{obj:c,parentObjId:e.objId,objId:t.objId,args:a,prop:r.prop},i),t};return c.objId=-1,void 0!==r.getter&&(c.objId=s,assign(c,n[r.getter],n)),wrapper(e,c,"api.getter",{parentObjId:e.objId,objId:c.objId,prop:r.prop},i,function(){delete t["__"+r.prop+"CacheValue"]}),a&&(this["__"+r.prop+"CacheValue"]=c),c},set:function(t){var n=new Error("").stack.split("\n").slice(2).join("\n");return wrapper(e,{},"api.setter",{parentObjId:e.objId,objId:-1,prop:r.prop,value:t},n)}})};t.length;)r()}function wrapper(e,t,n,r,a,o){var i=Promise.resolve(e).catch(function(){}).then(function(){return apiChannel(n,r,a,o)});t.then=function(e,t){return i.then(e,t)},t.catch=function(e){return i.catch(e)},t.Destroy=function(){return apiChannel("api.free",{objId:t.objId},"")}}var EventTypes={fileOpen:"fileOpen",tabSwitch:"tabSwitch",fileSaved:"fileSaved",error:"error"},Listener=function(e,t){void 0===e&&(e={});Message.add(function(n){var r=Message.parse(n.data),a=r.eventName,o=void 0===a?"":a,i=r.data,s=void 0===i?null:i,c=r.url,u=void 0===c?null:c;-1===["wps.jssdk.api"].indexOf(o)&&("ready"===o?(sendMsgToWps({eventName:"setConfig",data:e}),wps.tokenData&&wps.setToken(wps.tokenData),wps.iframeReady=!0):"error"===o?wps.emit(EventTypes.error,s):"open.result"===o?wps.emit(EventTypes.fileOpen,s):"file.saved"===o?wps.emit(EventTypes.fileSaved,s):"tab.switch"===o?wps.emit(EventTypes.tabSwitch,s):"api.scroll"===o&&window.scrollTo(s.x,s.y),"function"==typeof t[o]&&t[o](wps,u||s))})};function makeReady(e){return new Promise(function(t){var n=function(r){var a=Message.parse(r.data),o=a.eventName,i=a.data;o===e&&("api.ready"===o&&initApplication(wps,i),t(),Message.remove(n))};Message.add(n)})}function config(e){void 0===e&&(e={}),wps&&wps.destroy();try{var t=userConfHandler(e),n=t.subscriptions,r=void 0===n?{}:n,a=t.mount,o=void 0===a?null:a,i=t.url,s=getIframe(i,o),c=makeReady("ready"),u=makeReady("api.ready");return delete t.mount,i&&delete t.url,delete t.subscriptions,wps=__assign({},wps={url:i,version:"1.1.2",iframe:s,iframeReady:!1,tokenData:null,commandBars:null,tabs:{getTabs:function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,c];case 1:return e.sent(),[2,apiBasicChannel({api:"tab.getTabs"})]}})})},switchTab:function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,c];case 1:return t.sent(),[2,apiBasicChannel({api:"tab.switchTab",args:{tabKey:e}})]}})})}},setCooperUserColor:function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,c];case 1:return t.sent(),[2,apiBasicChannel({api:"setCooperUserColor",args:e})]}})})},setToken:function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,c];case 1:return t.sent(),wps.tokenData=e,sendMsgToWps({eventName:"setToken",data:e}),[2]}})})},ready:function(){return u},destroy:function(){s.destroy(),Message.empty(),wps=null,destroyApplication()},save:function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,c];case 1:return e.sent(),[2,apiChannelOld({api:"save"})]}})})},setCommandBars:function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,c];case 1:return t.sent(),setCommandBars(e),[2]}})})},updateConfig:function(e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,c];case 1:return t.sent(),e.commandBars?(console.warn("Deprecated: `updateConfig()` 方法即将废弃，请使用`setCommandBars()`代替`updateConfig()`更新`commandBars`配置。"),[2,setCommandBars(e.commandBars)]):[2]}})})}},new mitt.prototype.constructor),Listener(t,r),wps.ready(),wps}catch(e){console.error(e)}}console.log("WebOfficeSDK JS-SDK V1.1.2");var wps$1=Object.freeze({Listener:Listener,config:config});window.WPS=wps$1;var config$1=config,index={config:config$1};exports.config=config$1,exports.default=index;
